"use strict";(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[241],{4007:function(e,a,l){l.r(a),l.d(a,{default:function(){return xl}});var s=l(6436),t=l(7959),i=l(5167),n=l(6173),o=l(1810),c=l(4605),u=(l(4114),l(8111),l(1701),l(4603),l(7566),l(8721),l(1469)),r=l(648);const d={class:"modal-header"},v={class:"modal-title"},p={class:"modal-body"},f={class:"form-group"},k=["disabled"],h={class:"form-group"},m=["disabled"],L={key:0,class:"form-hint"},b={class:"form-group"},g={class:"form-label"},y={class:"switch"},_=["disabled"],C={key:0,class:"extension-config"},w={class:"form-subgroup"},E=["disabled"],x={class:"form-subgroup"},X=["disabled"],W={class:"form-subgroup"},K=["disabled"],D={key:0,class:"form-group"},F={class:"file-selector readonly"},I={key:0,class:"no-file-selected"},R={key:1,class:"selected-file"},Q={class:"file-info"},S={class:"file-name"},N={class:"file-path"},B={key:1,class:"form-group"},M={class:"selected-file readonly"},V={class:"file-info"},P={class:"file-name"},$={class:"file-path"},j={key:2,class:"form-group"},T=["disabled"],O={class:"modal-footer"},J=["disabled"],U=["disabled"],z={key:0,class:"loading-spinner"};var A={__name:"ShareEditModal",props:{visible:{type:Boolean,default:!1},mode:{type:String,default:"create",validator:e=>["create","edit"].includes(e)},shareData:{type:Object,default:null},selectedFile:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["close","confirm","select-file"],setup(e,{emit:a}){const l=e,n=a,o=(0,i.KR)({shareName:"",accessPassword:"",extension:"",fileId:""}),c=(0,i.KR)(!1),r=(0,i.KR)({btn:"",url:"",image:""}),A=(0,s.EW)(()=>"edit"===l.mode),G=(0,s.EW)(()=>l.shareData?.access_password||""),H=(0,s.EW)(()=>A.value?o.value.shareName.trim():o.value.shareName.trim()&&l.selectedFile);(0,s.wB)(()=>l.shareData,e=>{if(e&&A.value){o.value.shareName=e.share_name||"",o.value.accessPassword=e.access_password||"",o.value.fileId=e.file_id?String(e.file_id):"";let l={};try{l=JSON.parse(e.extension||"{}")}catch(a){l={}}r.value={btn:l.btn||"",url:l.url||"",image:l.image||""},c.value=!!(r.value.btn||r.value.url||r.value.image)}},{immediate:!0}),(0,s.wB)(()=>l.visible,e=>{e&&!A.value&&(o.value.shareName="",o.value.accessPassword="",o.value.fileId="",c.value=!1,r.value={btn:"",url:"",image:""})});const Y=e=>{const a={image:"fas fa-image file-type-icon image",video:"fas fa-video file-type-icon video",audio:"fas fa-music file-type-icon audio",document:"fas fa-file-alt file-type-icon document",archive:"fas fa-file-archive file-type-icon archive",pdf:"fas fa-file-pdf file-type-icon document",text:"fas fa-file-alt file-type-icon document",code:"fas fa-code file-type-icon document",unknown:"fas fa-file file-type-icon"};return a[e]||a["unknown"]},q=e=>{e.target===e.currentTarget&&Z()},Z=()=>{n("close")},ee=()=>{if(!H.value)return;let e="{}";if(c.value){const a={};r.value.btn&&r.value.btn.trim()&&(a.btn=r.value.btn.trim()),r.value.url&&r.value.url.trim()&&(a.url=r.value.url.trim()),r.value.image&&r.value.image.trim()&&(a.image=r.value.image.trim()),e=JSON.stringify(a)}const a={shareName:o.value.shareName.trim(),extension:e};a.accessPassword=o.value.accessPassword,A.value&&(a.shareId=l.shareData.share_id||l.shareData.id,o.value.fileId.trim()&&(a.fileId=parseInt(o.value.fileId.trim()))),n("confirm",a)};return(a,l)=>e.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:q},[(0,s.Lk)("div",{class:"modal-content",onClick:l[7]||(l[7]=(0,u.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",d,[(0,s.Lk)("h3",v,(0,t.v_)(A.value?"编辑分享":"创建分享"),1),(0,s.Lk)("button",{class:"modal-close",onClick:Z},l[8]||(l[8]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",p,[(0,s.Lk)("div",f,[l[9]||(l[9]=(0,s.Lk)("label",{class:"form-label"},"分享名称",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=e=>o.value.shareName=e),placeholder:"请输入分享名称（最多8个字符）",class:"form-input",maxlength:"8",disabled:e.loading},null,8,k),[[u.Jo,o.value.shareName]])]),(0,s.Lk)("div",h,[l[10]||(l[10]=(0,s.Lk)("label",{class:"form-label"},"访问密码（可选）",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=e=>o.value.accessPassword=e),placeholder:"留空表示无密码访问",class:"form-input",maxlength:"20",disabled:e.loading},null,8,m),[[u.Jo,o.value.accessPassword]]),A.value&&G.value?((0,s.uX)(),(0,s.CE)("div",L," 原密码："+(0,t.v_)(G.value),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",b,[(0,s.Lk)("label",g,[l[12]||(l[12]=(0,s.Lk)("span",null,"扩展功能（可选）",-1)),(0,s.Lk)("label",y,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=e=>c.value=e),disabled:e.loading},null,8,_),[[u.lH,c.value]]),l[11]||(l[11]=(0,s.Lk)("span",{class:"slider"},null,-1))])]),c.value?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",w,[l[13]||(l[13]=(0,s.Lk)("label",{class:"form-sublabel"},"按钮名称",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=e=>r.value.btn=e),placeholder:"例如：打赏支持",class:"form-input",maxlength:"20",disabled:e.loading},null,8,E),[[u.Jo,r.value.btn]])]),(0,s.Lk)("div",x,[l[14]||(l[14]=(0,s.Lk)("label",{class:"form-sublabel"},"按钮链接",-1)),(0,s.bo)((0,s.Lk)("input",{type:"url","onUpdate:modelValue":l[4]||(l[4]=e=>r.value.url=e),placeholder:"例如：https://example.com",class:"form-input",disabled:e.loading},null,8,X),[[u.Jo,r.value.url]])]),(0,s.Lk)("div",W,[l[15]||(l[15]=(0,s.Lk)("label",{class:"form-sublabel"},"图片链接",-1)),(0,s.bo)((0,s.Lk)("input",{type:"url","onUpdate:modelValue":l[5]||(l[5]=e=>r.value.image=e),placeholder:"例如：https://example.com/qrcode.png",class:"form-input",disabled:e.loading},null,8,K),[[u.Jo,r.value.image]])]),l[16]||(l[16]=(0,s.Lk)("div",{class:"form-hint"}," 可以只设置按钮、只设置图片，或者两者都设置 ",-1))])):(0,s.Q3)("",!0)]),A.value?e.shareData?((0,s.uX)(),(0,s.CE)("div",B,[l[19]||(l[19]=(0,s.Lk)("label",{class:"form-label"},"分享文件",-1)),(0,s.Lk)("div",M,[(0,s.Lk)("i",{class:(0,t.C4)([Y(e.shareData.file_type),"file-icon"])},null,2),(0,s.Lk)("div",V,[(0,s.Lk)("div",P,"文件ID: "+(0,t.v_)(e.shareData.file_id),1),(0,s.Lk)("div",$,(0,t.v_)(e.shareData.file_path||"文件路径信息"),1)])])])):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",D,[l[18]||(l[18]=(0,s.Lk)("label",{class:"form-label"},"选择文件",-1)),(0,s.Lk)("div",F,[e.selectedFile?((0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("i",{class:(0,t.C4)([Y(e.selectedFile.file_type||e.selectedFile.type),"file-icon"])},null,2),(0,s.Lk)("div",Q,[(0,s.Lk)("div",S,(0,t.v_)(e.selectedFile.file_name||e.selectedFile.name),1),(0,s.Lk)("div",N,(0,t.v_)(e.selectedFile.file_path||e.selectedFile.path),1)])])):((0,s.uX)(),(0,s.CE)("div",I,l[17]||(l[17]=[(0,s.Lk)("i",{class:"fas fa-file"},null,-1),(0,s.Lk)("span",null,"请选择要分享的文件",-1)])))])])),A.value?((0,s.uX)(),(0,s.CE)("div",j,[l[20]||(l[20]=(0,s.Lk)("label",{class:"form-label"},"文件ID",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=e=>o.value.fileId=e),class:"form-input",placeholder:"输入新的文件ID（留空表示不修改）",disabled:e.loading},null,8,T),[[u.Jo,o.value.fileId]]),l[21]||(l[21]=(0,s.Lk)("div",{class:"form-hint"},"留空表示不修改当前关联的文件",-1))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",O,[(0,s.Lk)("button",{class:"modal-btn secondary",onClick:Z,disabled:e.loading}," 取消 ",8,J),(0,s.Lk)("button",{class:"modal-btn primary",onClick:ee,disabled:e.loading||!H.value},[e.loading?((0,s.uX)(),(0,s.CE)("span",z)):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,t.v_)(e.loading?A.value?"保存中...":"创建中...":A.value?"保存":"创建分享"),1)],8,U)])])])):(0,s.Q3)("",!0)}};const G=A;var H=G;const Y={class:"modal-body"},q={class:"share-info"},Z={class:"info-row"},ee={class:"info-row"},ae={class:"share-code"},le={class:"info-row"},se={class:"form-group"},te={class:"link-display"},ie=["value"],ne=["disabled"],oe={class:"form-group"},ce={class:"password-display"},ue={key:0,class:"password-text"},re={key:1,class:"password-text"},de={key:2,class:"no-password-text"},ve={key:0,class:"form-group"},pe={class:"extension-display"},fe=["value"],ke={key:1,class:"copy-success"};var he={__name:"ShareInfoModal",props:{visible:{type:Boolean,default:!1},shareData:{type:Object,default:null}},emits:["close"],setup(e,{emit:a}){const l=e,n=a,o=(0,i.KR)(!1),c=(0,i.KR)(""),r=(0,i.KR)(!1),d=(0,i.KR)(null),v=(0,s.EW)(()=>{const e=d.value||l.shareData;if(!e?.share_code)return"";const a=window.location.origin;return`${a}/download?code=${e.share_code}`}),p=(0,s.EW)(()=>d.value||l.shareData);(0,s.wB)(()=>l.visible,e=>{e?e&&l.shareData&&(d.value=l.shareData):(o.value=!1,c.value="",d.value=null)});const f=e=>{e.target===e.currentTarget&&k()},k=()=>{n("close")},h=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(a){const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select();try{return document.execCommand("copy"),document.body.removeChild(s),!0}catch(l){return document.body.removeChild(s),!1}}},m=e=>{c.value=e,o.value=!0,setTimeout(()=>{o.value=!1},2e3)},L=async()=>{if(!v.value)return;const e=await h(v.value);m(e?"访问链接已复制到剪贴板":"复制失败，请手动复制")},b=async()=>{const e=p.value;if(!e?.access_password)return void m("该分享无密码保护");const a=e.access_password;if(!a)return void m("密码信息未加载，请重新打开分享信息");const l=await h(a);m(l?"访问密码已复制到剪贴板":"复制失败，请手动复制")},g=async()=>{const e=p.value;if(!e?.extension)return void m("该分享无扩展数据");const a=await h(e.extension);m(a?"扩展数据已复制到剪贴板":"复制失败，请手动复制")},y=async()=>{const e=p.value;if(!e)return;const a=e.access_password||"无密码",l=e.extension&&"{}"!==e.extension?e.extension:"无扩展数据",s=[`分享名称：${e.share_name||""}`,`访问链接：${v.value}`,`访问密码：${a}`,`文件ID：${e.file_id||""}`,`分享代码：${e.share_code||""}`,`扩展数据：${l}`].join("\n"),t=await h(s);m(t?"分享信息已复制到剪贴板":"复制失败，请手动复制")};return(a,l)=>e.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:f},[(0,s.Lk)("div",{class:"modal-content",onClick:l[0]||(l[0]=(0,u.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:"modal-header"},[l[2]||(l[2]=(0,s.Lk)("h3",{class:"modal-title"},"分享信息",-1)),(0,s.Lk)("button",{class:"modal-close",onClick:k},l[1]||(l[1]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",Y,[(0,s.Lk)("div",q,[(0,s.Lk)("div",Z,[l[3]||(l[3]=(0,s.Lk)("label",null,"分享名称：",-1)),(0,s.Lk)("span",null,(0,t.v_)(p.value?.share_name||""),1)]),(0,s.Lk)("div",ee,[l[4]||(l[4]=(0,s.Lk)("label",null,"分享代码：",-1)),(0,s.Lk)("span",ae,(0,t.v_)(p.value?.share_code||""),1)]),(0,s.Lk)("div",le,[l[5]||(l[5]=(0,s.Lk)("label",null,"文件ID：",-1)),(0,s.Lk)("span",null,(0,t.v_)(p.value?.file_id||""),1)])]),(0,s.Lk)("div",se,[l[7]||(l[7]=(0,s.Lk)("label",{class:"form-label"},"访问链接",-1)),(0,s.Lk)("div",te,[(0,s.Lk)("input",{type:"text",class:"form-input readonly-text",value:v.value,readonly:""},null,8,ie),(0,s.Lk)("button",{class:"copy-btn",onClick:L,disabled:!v.value},l[6]||(l[6]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1)]),8,ne)])]),(0,s.Lk)("div",oe,[l[9]||(l[9]=(0,s.Lk)("label",{class:"form-label"},"访问密码",-1)),(0,s.Lk)("div",ce,[r.value?((0,s.uX)(),(0,s.CE)("div",ue," 正在加载密码... ")):p.value?.access_password?((0,s.uX)(),(0,s.CE)("div",re,(0,t.v_)(p.value.access_password),1)):((0,s.uX)(),(0,s.CE)("div",de," 该分享无密码保护 ")),p.value?.access_password&&!r.value?((0,s.uX)(),(0,s.CE)("button",{key:3,class:"copy-btn",onClick:b},l[8]||(l[8]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1)]))):(0,s.Q3)("",!0)])]),p.value?.extension&&"{}"!==p.value.extension?((0,s.uX)(),(0,s.CE)("div",ve,[l[11]||(l[11]=(0,s.Lk)("label",{class:"form-label"},"扩展数据",-1)),(0,s.Lk)("div",pe,[(0,s.Lk)("textarea",{class:"form-input readonly-text",value:p.value.extension,readonly:"",rows:"3"},null,8,fe),(0,s.Lk)("button",{class:"copy-btn",onClick:g},l[10]||(l[10]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1)]))])])):(0,s.Q3)("",!0),o.value?((0,s.uX)(),(0,s.CE)("div",ke,[l[12]||(l[12]=(0,s.Lk)("i",{class:"fas fa-check"},null,-1)),(0,s.eW)(" "+(0,t.v_)(c.value),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:"modal-footer"},[(0,s.Lk)("button",{class:"modal-btn secondary",onClick:y},l[13]||(l[13]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1),(0,s.eW)(" 复制全部信息 ")])),(0,s.Lk)("button",{class:"modal-btn primary",onClick:k}," 关闭 ")])])])):(0,s.Q3)("",!0)}};const me=he;var Le=me;const be={class:"file-list-container"},ge={class:"file-card"},ye={class:"search-and-batch-actions"},_e={class:"left-section"},Ce={class:"action-buttons"},we=["disabled"],Ee={class:"right-section"},xe={class:"search-controls"},Xe={key:0,class:"empty-state"},We={key:1,class:"empty-state"},Ke={key:2,class:"table-wrapper"},De={class:"table-min"},Fe={class:"file-table"},Ie=["checked"],Re=["value"],Qe={class:"share-code-cell"},Se=["onClick"],Ne={class:"file-id"},Be={class:"stats-cell"},Me={class:"stats-number"},Ve={class:"stats-cell"},Pe={class:"stats-number"},$e=["onClick"],je=["onClick"],Te=["onClick"],Oe={key:3,class:"pagination-container"},Je={class:"page-info"},Ue={class:"pagination"},ze=["disabled"],Ae=["onClick"],Ge={key:0,class:"page-ellipsis"},He=["disabled"];var Ye={__name:"Share-List",setup(e,{expose:a}){const l=(0,s.WQ)("notification"),n=(0,s.WQ)("confirm"),o=(0,i.KR)([]),c=(0,i.KR)([]),d=(0,i.KR)(""),v=(0,i.KR)(!1),p=(0,i.KR)(1),f=(0,i.KR)({page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1}),k=(0,i.KR)({visible:!1,mode:"edit",shareData:null,loading:!1}),h=(0,i.KR)({visible:!1,shareData:null}),m=(0,s.EW)(()=>o.value.length>0&&c.value.length===o.value.length),L=async(e,a={})=>{try{const s=await(0,r.Bf)();if(!s)return l.open({type:"error",title:"认证失败",message:"请重新登录",onClose:()=>window.location.reload()}),null;const t=new FormData;t.append("action",e);const i=(0,r.fM)();i&&t.append("jwt",i);for(const[e,l]of Object.entries(a))null!==l&&void 0!==l&&""!==l&&t.append(e,l);const n=await fetch("/api/share/share-api.php",{method:"POST",body:t,credentials:"include"}),o=await n.json();if(!o.success)throw new Error(o.message||"操作失败");return o}catch(s){throw s}},b=()=>{m.value?c.value=[]:c.value=o.value.map(e=>e.id)},g=e=>new Date(e).toLocaleString("zh-CN"),y=()=>{const e=f.value.total_pages,a=f.value.page,l=[];if(e<=7)for(let s=1;s<=e;s++)l.push(s);else{l.push(1),a>4&&l.push("...");const s=Math.max(2,a-1),t=Math.min(e-1,a+1);for(let e=s;e<=t;e++)l.push(e);a<e-3&&l.push("..."),l.push(e)}return l},_=e=>{e>=1&&e<=f.value.total_pages&&(p.value=e,Q())},C=()=>{p.value=1,Q()},w=()=>{d.value="",p.value=1,Q()},E=()=>{d.value="",p.value=1,Q()},x=e=>{h.value={visible:!0,shareData:e}},X=()=>{h.value.visible=!1},W=e=>{x(e)},K=e=>{k.value={visible:!0,mode:"edit",shareData:e,loading:!1}},D=()=>{k.value.visible=!1},F=async e=>{k.value.loading=!0;try{const a={share_id:e.shareId,share_name:e.shareName,access_password:e.accessPassword,extension:e.extension};e.fileId&&(a.file_id=e.fileId);const s=await L("update_share",a);s&&(l.open({type:"success",title:"修改成功",message:"分享信息已更新",duration:3e3}),D(),await Q())}catch(a){l.open({type:"error",title:"操作失败",message:a.message})}finally{k.value.loading=!1}},I=async e=>{n.open({title:"确认删除",message:`确定要删除分享"${e.share_name}"吗？`,onConfirm:async()=>{try{const a=await L("delete_share",{share_id:e.id});a&&(l.open({type:"success",title:"删除成功",message:"分享已删除",duration:3e3}),await Q())}catch(a){l.open({type:"error",title:"删除失败",message:a.message})}}})},R=async()=>{c.value.length?n.open({title:"确认批量删除",message:`确定要删除选中的 ${c.value.length} 个分享吗？`,onConfirm:async()=>{try{const e=c.value.map(e=>L("delete_share",{share_id:e}));await Promise.all(e),c.value=[],l.open({type:"success",title:"批量删除成功",message:"已删除所有选中的分享",duration:3e3}),await Q()}catch(e){l.open({type:"error",title:"批量删除失败",message:e.message})}}}):l.open({type:"warning",title:"提示",message:"请先选择要删除的分享",duration:3e3})},Q=async()=>{try{v.value=!0;const e=await(0,r.Bf)();if(!e)return void l.open({type:"error",title:"认证失败",message:"请重新登录",onClose:()=>window.location.reload()});const a=new URLSearchParams({page:p.value,per_page:20});d.value.trim()?(a.append("action","search_shares"),a.append("keyword",d.value.trim())):a.append("action","list_shares");const s=(0,r.fM)();s&&a.append("jwt",s);const t=await fetch(`/api/share/share-api.php?${a.toString()}`,{method:"GET",credentials:"include"}),i=await t.json();if(!i.success)throw new Error(i.message);o.value=i.data||[],f.value=i.pagination||{}}catch(e){l.open({type:"error",title:"加载失败",message:e.message})}finally{v.value=!1}};return(0,s.sV)(()=>{Q()}),a({refresh:Q}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",be,[(0,s.Lk)("div",ge,[(0,s.Lk)("div",ye,[(0,s.Lk)("div",_e,[a[6]||(a[6]=(0,s.Lk)("h3",null,"分享列表",-1)),(0,s.Lk)("div",Ce,[(0,s.Lk)("button",{class:"batch-btn",onClick:R,disabled:!c.value.length},a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-unlink"},null,-1),(0,s.eW)(" 取消分享 ")]),8,we),(0,s.Lk)("button",{class:"batch-btn",onClick:w},a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" 刷新 ")]))])]),(0,s.Lk)("div",Ee,[(0,s.Lk)("div",xe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"搜索分享名称...",class:"search-input",onKeyup:(0,u.jR)(C,["enter"])},null,544),[[u.Jo,d.value]]),(0,s.Lk)("button",{class:"batch-btn",onClick:C},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-search"},null,-1),(0,s.eW)(" 搜索 ")])),d.value?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"batch-btn",onClick:E},a[8]||(a[8]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" 清除搜索 ")]))):(0,s.Q3)("",!0)])])]),v.value?((0,s.uX)(),(0,s.CE)("div",Xe,a[9]||(a[9]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.eW)(" 加载中... ")]))):o.value.length?((0,s.uX)(),(0,s.CE)("div",Ke,[(0,s.Lk)("div",De,[(0,s.Lk)("table",Fe,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,[(0,s.Lk)("input",{type:"checkbox",onChange:b,checked:m.value},null,40,Ie)]),a[11]||(a[11]=(0,s.Lk)("th",null,"分享名称",-1)),a[12]||(a[12]=(0,s.Lk)("th",null,"分享代码",-1)),a[13]||(a[13]=(0,s.Lk)("th",null,"文件ID",-1)),a[14]||(a[14]=(0,s.Lk)("th",null,"创建时间",-1)),a[15]||(a[15]=(0,s.Lk)("th",null,"访问次数",-1)),a[16]||(a[16]=(0,s.Lk)("th",null,"下载次数",-1)),a[17]||(a[17]=(0,s.Lk)("th",{class:"password-cell"},"密码保护",-1)),a[18]||(a[18]=(0,s.Lk)("th",null,"操作",-1))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),value:e.id},null,8,Re),[[u.lH,c.value]])]),(0,s.Lk)("td",null,(0,t.v_)(e.share_name),1),(0,s.Lk)("td",Qe,[(0,s.Lk)("span",{class:"share-code",onClick:a=>x(e),title:"点击查看分享信息"},(0,t.v_)(e.share_code),9,Se)]),(0,s.Lk)("td",null,[(0,s.Lk)("span",Ne,(0,t.v_)(e.file_id||"-"),1)]),(0,s.Lk)("td",null,(0,t.v_)(g(e.created_time)),1),(0,s.Lk)("td",Be,[(0,s.Lk)("span",Me,(0,t.v_)(e.view_count),1)]),(0,s.Lk)("td",Ve,[(0,s.Lk)("span",Pe,(0,t.v_)(e.download_count),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"password-btn",onClick:a=>W(e)},(0,t.v_)(e.access_password?"有密码":"无密码"),9,$e)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"action-btn",onClick:a=>K(e)},"编辑",8,je),(0,s.Lk)("button",{class:"action-btn",onClick:a=>I(e),style:{"margin-left":"8px"}},"删除",8,Te)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",We,a[10]||(a[10]=[(0,s.Lk)("div",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-share-alt"})],-1),(0,s.Lk)("div",{class:"title"},"暂无分享",-1),(0,s.Lk)("div",{class:"description"}," 请先创建分享链接 ",-1)]))),f.value.total_pages>1?((0,s.uX)(),(0,s.CE)("div",Oe,[(0,s.Lk)("span",Je," 第 "+(0,t.v_)(f.value.page)+" 页，共 "+(0,t.v_)(f.value.total_pages)+" 页 ("+(0,t.v_)(f.value.total)+" 项) ",1),(0,s.Lk)("div",Ue,[(0,s.Lk)("button",{disabled:!f.value.has_prev,onClick:a[2]||(a[2]=e=>_(f.value.page-1))},a[19]||(a[19]=[(0,s.Lk)("i",{class:"fas fa-chevron-left"},null,-1),(0,s.eW)(" 上一页 ")]),8,ze),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y(),e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:e,class:(0,t.C4)({active:e===f.value.page}),onClick:a=>_(e)},(0,t.v_)(e),11,Ae)),[[u.aG,"..."!==e]])),128)),y().includes("...")?((0,s.uX)(),(0,s.CE)("span",Ge,"...")):(0,s.Q3)("",!0),(0,s.Lk)("button",{disabled:!f.value.has_next,onClick:a[3]||(a[3]=e=>_(f.value.page+1))},a[20]||(a[20]=[(0,s.eW)(" 下一页 "),(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,He)])])):(0,s.Q3)("",!0)]),k.value.visible?((0,s.uX)(),(0,s.Wv)(H,{key:0,visible:k.value.visible,mode:k.value.mode,"share-data":k.value.shareData,loading:k.value.loading,onClose:D,onConfirm:F},null,8,["visible","mode","share-data","loading"])):(0,s.Q3)("",!0),h.value.visible?((0,s.uX)(),(0,s.Wv)(Le,{key:1,visible:h.value.visible,"share-data":h.value.shareData,onClose:X},null,8,["visible","share-data"])):(0,s.Q3)("",!0)]))}},qe=l(5932);const Ze=(0,qe.A)(Ye,[["__scopeId","data-v-496be869"]]);var ea=Ze;const aa={class:"file-list-container"},la={class:"file-card"},sa={class:"search-and-batch-actions"},ta={class:"left-section"},ia={class:"action-buttons"},na=["disabled"],oa={class:"right-section"},ca={class:"search-controls"},ua={key:0,class:"empty-state"},ra={key:1,class:"empty-state"},da={key:2,class:"table-wrapper"},va={class:"table-min"},pa={class:"file-table"},fa=["checked"],ka=["value"],ha={class:"file-id"},ma={class:"user-id"},La=["onClick"],ba=["onClick"],ga={key:3,class:"pagination-container"},ya={class:"page-info"},_a={class:"pagination"},Ca=["disabled"],wa=["onClick"],Ea={key:0,class:"page-ellipsis"},xa=["disabled"];var Xa={__name:"Share-File",emits:["create-share"],setup(e,{expose:a,emit:l}){const n=(0,s.WQ)("notification"),o=(0,s.WQ)("confirm"),c=(0,i.KR)([]),d=(0,i.KR)([]),v=(0,i.KR)(""),p=(0,i.KR)(!1),f=(0,i.KR)(1),k=(0,i.KR)({page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1}),h=(0,i.KR)({visible:!1,selectedFile:null,loading:!1}),m=l,L=async(e,a={})=>{try{const l=await(0,r.Bf)();if(!l)return n.open({type:"error",title:"认证失败",message:"请重新登录",onClose:()=>window.location.reload()}),null;const s=new FormData;s.append("action",e);const t=(0,r.fM)();t&&s.append("jwt",t);for(const[e,n]of Object.entries(a))null!==n&&void 0!==n&&""!==n&&s.append(e,n);const i=await fetch("/api/share/share-api.php",{method:"POST",body:s,credentials:"include"}),o=await i.json();if(!o.success)throw new Error(o.message||"操作失败");return o}catch(l){throw l}},b=(0,s.EW)(()=>c.value.length>0&&d.value.length===c.value.length),g=()=>{b.value?d.value=[]:d.value=c.value.map(e=>e.id)},y=e=>{const a={image:"fas fa-image",video:"fas fa-video",audio:"fas fa-music",document:"fas fa-file-alt",text:"fas fa-file-text",archive:"fas fa-file-archive",other:"fas fa-file"};return a[e]||a.other},_=e=>{const a={image:"图片",video:"视频",audio:"音频",document:"文档",text:"文本",archive:"压缩包",other:"其他"};return a[e]||"未知"},C=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,s)).toFixed(1))+" "+l[s]},w=e=>new Date(e).toLocaleString("zh-CN"),E=()=>{const e=k.value.total_pages,a=k.value.page,l=[];if(e<=7)for(let s=1;s<=e;s++)l.push(s);else{l.push(1),a>4&&l.push("...");const s=Math.max(2,a-1),t=Math.min(e-1,a+1);for(let e=s;e<=t;e++)l.push(e);a<e-3&&l.push("..."),l.push(e)}return l},x=e=>{e>=1&&e<=k.value.total_pages&&(f.value=e,N())},X=()=>{f.value=1,N()},W=()=>{v.value="",f.value=1,N()},K=()=>{v.value="",f.value=1,N()},D=e=>{h.value={visible:!0,selectedFile:e,loading:!1}},F=()=>{h.value.visible=!1},I=()=>{n.open({type:"info",title:"提示",message:'请在列表中点击"创建分享"按钮选择文件',duration:3e3})},R=async e=>{h.value.loading=!0;try{const a=await L("create_share",{file_id:h.value.selectedFile.id,share_name:e.shareName,access_password:e.accessPassword,extension:e.extension});a&&(n.open({type:"success",title:"创建成功",message:`分享"${e.shareName}"已创建`,duration:3e3}),F(),m("create-share",a.data),await N())}catch(a){n.open({type:"error",title:"创建失败",message:a.message})}finally{h.value.loading=!1}},Q=async e=>{o.open({title:"确认移除",message:`确定要将"${e.file_name}"从分享列表中移除吗？`,onConfirm:async()=>{try{const a=await L("remove_share_file",{file_id:e.id});a&&(n.open({type:"success",title:"移除成功",message:"文件已从分享列表中移除",duration:3e3}),await N())}catch(a){n.open({type:"error",title:"操作失败",message:a.message})}}})},S=async()=>{d.value.length?o.open({title:"确认批量移除",message:`确定要将选中的 ${d.value.length} 个文件从分享列表中移除吗？`,onConfirm:async()=>{try{const e=d.value.map(e=>L("remove_share_file",{file_id:e}));await Promise.all(e),d.value=[],n.open({type:"success",title:"批量移除成功",message:"已将选中文件从分享列表中移除",duration:3e3}),await N()}catch(e){n.open({type:"error",title:"批量移除失败",message:e.message})}}}):n.open({type:"warning",title:"提示",message:"请先选择要移除的文件",duration:3e3})},N=async()=>{try{p.value=!0;const e=await(0,r.Bf)();if(!e)return void n.open({type:"error",title:"认证失败",message:"请重新登录",onClose:()=>window.location.reload()});const a=new URLSearchParams({page:f.value,per_page:20});v.value.trim()?(a.append("action","search_share_files"),a.append("keyword",v.value.trim())):a.append("action","list_share_files");const l=(0,r.fM)();l&&a.append("jwt",l);const s=await fetch(`/api/share/share-api.php?${a.toString()}`,{method:"GET",credentials:"include"}),t=await s.json();if(!t.success)throw new Error(t.message);c.value=t.data||[],k.value=t.pagination||{}}catch(e){n.open({type:"error",title:"加载失败",message:e.message})}finally{p.value=!1}};return(0,s.sV)(()=>{N()}),a({refresh:N}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",aa,[(0,s.Lk)("div",la,[(0,s.Lk)("div",sa,[(0,s.Lk)("div",ta,[a[6]||(a[6]=(0,s.Lk)("h3",null,"分享文件",-1)),(0,s.Lk)("div",ia,[(0,s.Lk)("button",{class:"batch-btn",onClick:S,disabled:!d.value.length},a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1),(0,s.eW)(" 移出分享 ")]),8,na),(0,s.Lk)("button",{class:"batch-btn",onClick:W},a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" 刷新 ")]))])]),(0,s.Lk)("div",oa,[(0,s.Lk)("div",ca,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),placeholder:"搜索文件路径...",class:"search-input",onKeyup:(0,u.jR)(X,["enter"])},null,544),[[u.Jo,v.value]]),(0,s.Lk)("button",{class:"batch-btn",onClick:X},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-search"},null,-1),(0,s.eW)(" 搜索 ")])),v.value?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"batch-btn",onClick:K},a[8]||(a[8]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" 清除搜索 ")]))):(0,s.Q3)("",!0)])])]),p.value?((0,s.uX)(),(0,s.CE)("div",ua,a[9]||(a[9]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.eW)(" 加载中... ")]))):c.value.length?((0,s.uX)(),(0,s.CE)("div",da,[(0,s.Lk)("div",va,[(0,s.Lk)("table",pa,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,[(0,s.Lk)("input",{type:"checkbox",onChange:g,checked:b.value},null,40,fa)]),a[11]||(a[11]=(0,s.Lk)("th",null,"文件名",-1)),a[12]||(a[12]=(0,s.Lk)("th",null,"文件ID",-1)),a[13]||(a[13]=(0,s.Lk)("th",null,"用户ID",-1)),a[14]||(a[14]=(0,s.Lk)("th",null,"文件路径",-1)),a[15]||(a[15]=(0,s.Lk)("th",null,"文件大小",-1)),a[16]||(a[16]=(0,s.Lk)("th",null,"文件类型",-1)),a[17]||(a[17]=(0,s.Lk)("th",null,"分享日期",-1)),a[18]||(a[18]=(0,s.Lk)("th",null,"操作",-1))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),value:e.id},null,8,ka),[[u.lH,d.value]])]),(0,s.Lk)("td",null,[(0,s.Lk)("i",{class:(0,t.C4)([y(e.file_type),"file-type-icon"])},null,2),(0,s.eW)(" "+(0,t.v_)(e.file_name),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("span",ha,(0,t.v_)(e.id||"-"),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("span",ma,(0,t.v_)(e.user_id||"-"),1)]),(0,s.Lk)("td",null,(0,t.v_)(e.file_path),1),(0,s.Lk)("td",null,(0,t.v_)(C(e.file_size)),1),(0,s.Lk)("td",null,(0,t.v_)(_(e.file_type)),1),(0,s.Lk)("td",null,(0,t.v_)(w(e.share_time)),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"action-btn",onClick:a=>D(e)}," 创建分享 ",8,La),(0,s.Lk)("button",{class:"action-btn",onClick:a=>Q(e),style:{"margin-left":"8px"}}," 移出列表 ",8,ba)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",ra,a[10]||(a[10]=[(0,s.Lk)("div",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-folder-open"})],-1),(0,s.Lk)("div",{class:"title"},"暂无分享文件",-1),(0,s.Lk)("div",{class:"description"}," 请先在文件管理页面添加文件到分享列表 ",-1)]))),k.value.total_pages>1?((0,s.uX)(),(0,s.CE)("div",ga,[(0,s.Lk)("span",ya," 第 "+(0,t.v_)(k.value.page)+" 页，共 "+(0,t.v_)(k.value.total_pages)+" 页 ("+(0,t.v_)(k.value.total)+" 项) ",1),(0,s.Lk)("div",_a,[(0,s.Lk)("button",{disabled:!k.value.has_prev,onClick:a[2]||(a[2]=e=>x(k.value.page-1))},a[19]||(a[19]=[(0,s.Lk)("i",{class:"fas fa-chevron-left"},null,-1),(0,s.eW)(" 上一页 ")]),8,Ca),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(E(),e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:e,class:(0,t.C4)({active:e===k.value.page}),onClick:a=>x(e)},(0,t.v_)(e),11,wa)),[[u.aG,"..."!==e]])),128)),E().includes("...")?((0,s.uX)(),(0,s.CE)("span",Ea,"...")):(0,s.Q3)("",!0),(0,s.Lk)("button",{disabled:!k.value.has_next,onClick:a[3]||(a[3]=e=>x(k.value.page+1))},a[20]||(a[20]=[(0,s.eW)(" 下一页 "),(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,xa)])])):(0,s.Q3)("",!0)]),(0,s.bF)(H,{visible:h.value.visible,mode:"create","selected-file":h.value.selectedFile,loading:h.value.loading,onClose:F,onConfirm:R,onSelectFile:I},null,8,["visible","selected-file","loading"])]))}};const Wa=(0,qe.A)(Xa,[["__scopeId","data-v-9910a2c4"]]);var Ka=Wa;const Da={class:"file-list-container"},Fa={class:"file-card"},Ia={key:0,class:"empty-state"},Ra={key:1,class:"empty-state"},Qa={key:2,class:"table-wrapper"},Sa={class:"table-min"},Na={class:"file-table"},Ba={class:"user-id"},Ma={key:3,class:"pagination-container"},Va={class:"page-info"},Pa={class:"pagination"},$a=["disabled"],ja=["onClick"],Ta={key:0,class:"page-ellipsis"},Oa=["disabled"];var Ja={__name:"AdminFileView",setup(e){const a=(0,s.WQ)("notification"),l=(0,i.KR)([]),n=(0,i.KR)(!1),o=(0,i.KR)(1),c=(0,i.KR)({page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1}),d=async(e=1)=>{n.value=!0;try{const a={action:"get_all_share_files",page:e,per_page:c.value.per_page},s=await(0,r.Em)("/api/share/admin-api.php",{method:"POST",body:JSON.stringify(a)});if(!s.success)throw new Error(s.message||"获取分享文件列表失败");l.value=s.data||[],c.value=s.pagination||{page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1},o.value=e}catch(s){a.open({type:"error",title:"获取失败",message:s.message||"获取分享文件列表失败"}),l.value=[]}finally{n.value=!1}},v=e=>{const a={image:"fas fa-image file-type-icon image",video:"fas fa-video file-type-icon video",audio:"fas fa-music file-type-icon audio",document:"fas fa-file-alt file-type-icon document",archive:"fas fa-file-archive file-type-icon archive",pdf:"fas fa-file-pdf file-type-icon document",text:"fas fa-file-alt file-type-icon document",code:"fas fa-code file-type-icon document",unknown:"fas fa-file file-type-icon"};return a[e]||a["unknown"]},p=e=>{if(null===e||void 0===e)return"-";const a=["B","KB","MB","GB","TB"];let l=0,s=e;while(s>=1024&&l<a.length-1)s/=1024,l++;return 0===l?s+" "+a[l]:s.toFixed(2)+" "+a[l]},f=e=>{if(!e)return"-";const a=new Date(e),l=new Date,s=Math.abs(l-a),t=Math.ceil(s/864e5);return t<=1?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):a.getFullYear()===l.getFullYear()?a.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):a.toLocaleDateString("zh-CN")},k=()=>{const e=[],a=c.value.total_pages,l=c.value.page;if(a<=7)for(let s=1;s<=a;s++)e.push(s);else if(l<=4){for(let a=1;a<=5;a++)e.push(a);e.push("..."),e.push(a)}else if(l>=a-3){e.push(1),e.push("...");for(let l=a-4;l<=a;l++)e.push(l)}else{e.push(1),e.push("...");for(let a=l-1;a<=l+1;a++)e.push(a);e.push("..."),e.push(a)}return e},h=e=>{e>=1&&e<=c.value.total_pages&&d(e)},m=()=>{d(1)};return(0,s.sV)(()=>{d(1)}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",Da,[(0,s.Lk)("div",Fa,[(0,s.Lk)("div",{class:"search-and-batch-actions"},[a[3]||(a[3]=(0,s.Lk)("div",{class:"left-section"},[(0,s.Lk)("h3",null,"文件管理")],-1)),(0,s.Lk)("div",{class:"right-section"},[(0,s.Lk)("button",{class:"batch-btn",onClick:m},a[2]||(a[2]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" 刷新 ")]))])]),n.value?((0,s.uX)(),(0,s.CE)("div",Ia,a[4]||(a[4]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.eW)(" 加载中... ")]))):l.value.length?((0,s.uX)(),(0,s.CE)("div",Qa,[(0,s.Lk)("div",Sa,[(0,s.Lk)("table",Na,[a[6]||(a[6]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"文件名"),(0,s.Lk)("th",null,"用户ID"),(0,s.Lk)("th",null,"文件大小"),(0,s.Lk)("th",null,"文件类型"),(0,s.Lk)("th",null,"分享时间")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.Lk)("i",{class:(0,t.C4)([v(e.file_type),"file-type-icon"])},null,2),(0,s.eW)(" "+(0,t.v_)(e.file_name),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("span",Ba,(0,t.v_)(e.user_id||"-"),1)]),(0,s.Lk)("td",null,(0,t.v_)(p(e.file_size)),1),(0,s.Lk)("td",null,(0,t.v_)(e.file_type||"-"),1),(0,s.Lk)("td",null,(0,t.v_)(f(e.share_time)),1)]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Ra,a[5]||(a[5]=[(0,s.Lk)("div",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-file"})],-1),(0,s.Lk)("div",{class:"title"},"暂无分享文件",-1),(0,s.Lk)("div",{class:"description"}," 系统中暂无用户创建的分享文件 ",-1)]))),c.value.total_pages>1?((0,s.uX)(),(0,s.CE)("div",Ma,[(0,s.Lk)("span",Va," 第 "+(0,t.v_)(c.value.page)+" 页，共 "+(0,t.v_)(c.value.total_pages)+" 页 ("+(0,t.v_)(c.value.total)+" 项) ",1),(0,s.Lk)("div",Pa,[(0,s.Lk)("button",{disabled:!c.value.has_prev,onClick:a[0]||(a[0]=e=>h(c.value.page-1))},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-chevron-left"},null,-1),(0,s.eW)(" 上一页 ")]),8,$a),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k(),e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:e,class:(0,t.C4)({active:e===c.value.page}),onClick:a=>h(e)},(0,t.v_)(e),11,ja)),[[u.aG,"..."!==e]])),128)),k().includes("...")?((0,s.uX)(),(0,s.CE)("span",Ta,"...")):(0,s.Q3)("",!0),(0,s.Lk)("button",{disabled:!c.value.has_next,onClick:a[1]||(a[1]=e=>h(c.value.page+1))},a[8]||(a[8]=[(0,s.eW)(" 下一页 "),(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,Oa)])])):(0,s.Q3)("",!0)])]))}};const Ua=(0,qe.A)(Ja,[["__scopeId","data-v-618f9988"]]);var za=Ua;const Aa={class:"file-list-container"},Ga={class:"file-card"},Ha={key:0,class:"empty-state"},Ya={key:1,class:"empty-state"},qa={key:2,class:"table-wrapper"},Za={class:"table-min"},el={class:"file-table"},al={class:"share-code-cell"},ll={class:"share-code",title:"分享代码"},sl={class:"user-id"},tl={class:"stats-cell"},il={class:"stats-number"},nl={class:"stats-cell"},ol={class:"stats-number"},cl={class:"password-btn",disabled:""},ul=["onClick"],rl={key:3,class:"pagination-container"},dl={class:"page-info"},vl={class:"pagination"},pl=["disabled"],fl=["onClick"],kl={key:0,class:"page-ellipsis"},hl=["disabled"];var ml={__name:"AdminView",setup(e){const a=(0,s.WQ)("notification"),l=(0,s.WQ)("confirm"),n=(0,i.KR)([]),o=(0,i.KR)(!1),c=(0,i.KR)(1),d=(0,i.KR)({page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1}),v=async(e=1)=>{o.value=!0;try{const a={action:"get_all_shares",page:e,per_page:d.value.per_page},l=await(0,r.Em)("/api/share/admin-api.php",{method:"POST",body:JSON.stringify(a)});if(!l.success)throw new Error(l.message||"获取分享列表失败");n.value=l.data||[],d.value=l.pagination||{page:1,per_page:20,total:0,total_pages:1,has_next:!1,has_prev:!1},c.value=e}catch(l){a.open({type:"error",title:"获取失败",message:l.message||"获取分享列表失败"}),n.value=[]}finally{o.value=!1}},p=e=>{const a={image:"fas fa-image file-type-icon image",video:"fas fa-video file-type-icon video",audio:"fas fa-music file-type-icon audio",document:"fas fa-file-alt file-type-icon document",archive:"fas fa-file-archive file-type-icon archive",pdf:"fas fa-file-pdf file-type-icon document",text:"fas fa-file-alt file-type-icon document",code:"fas fa-code file-type-icon document",unknown:"fas fa-file file-type-icon"};return a[e]||a["unknown"]},f=e=>{if(!e)return"-";const a=new Date(e),l=new Date,s=Math.abs(l-a),t=Math.ceil(s/864e5);return t<=1?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):a.getFullYear()===l.getFullYear()?a.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):a.toLocaleDateString("zh-CN")},k=()=>{const e=[],a=d.value.total_pages,l=d.value.page;if(a<=7)for(let s=1;s<=a;s++)e.push(s);else if(l<=4){for(let a=1;a<=5;a++)e.push(a);e.push("..."),e.push(a)}else if(l>=a-3){e.push(1),e.push("...");for(let l=a-4;l<=a;l++)e.push(l)}else{e.push(1),e.push("...");for(let a=l-1;a<=l+1;a++)e.push(a);e.push("..."),e.push(a)}return e},h=e=>{e>=1&&e<=d.value.total_pages&&v(e)},m=()=>{v(1)},L=async e=>{try{const s=await l.open({title:"确认删除",message:`确定要删除分享 "${e.share_name}" 吗？此操作不可恢复。`,confirmText:"删除",cancelText:"取消"});if(!s)return;const t=await(0,r.Em)("/api/share/admin-api.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete_share",share_id:e.id})});if(!t)throw new Error("服务器无响应");if(!t.success)throw new Error(t.message||"删除失败");a.open({type:"success",title:"删除成功",message:"分享已成功删除"}),v(c.value)}catch(s){a.open({type:"error",title:"删除失败",message:s.message||"删除分享时发生错误"})}};return(0,s.sV)(()=>{v(1)}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",Aa,[(0,s.Lk)("div",Ga,[(0,s.Lk)("div",{class:"search-and-batch-actions"},[a[3]||(a[3]=(0,s.Lk)("div",{class:"left-section"},[(0,s.Lk)("h3",null,"分享管理")],-1)),(0,s.Lk)("div",{class:"right-section"},[(0,s.Lk)("button",{class:"batch-btn",onClick:m},a[2]||(a[2]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" 刷新 ")]))])]),o.value?((0,s.uX)(),(0,s.CE)("div",Ha,a[4]||(a[4]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.eW)(" 加载中... ")]))):n.value.length?((0,s.uX)(),(0,s.CE)("div",qa,[(0,s.Lk)("div",Za,[(0,s.Lk)("table",el,[a[6]||(a[6]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"分享名称"),(0,s.Lk)("th",null,"分享代码"),(0,s.Lk)("th",null,"文件名"),(0,s.Lk)("th",null,"用户ID"),(0,s.Lk)("th",null,"创建时间"),(0,s.Lk)("th",null,"访问次数"),(0,s.Lk)("th",null,"下载次数"),(0,s.Lk)("th",{class:"password-cell"},"访问密码"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,t.v_)(e.share_name),1),(0,s.Lk)("td",al,[(0,s.Lk)("span",ll,(0,t.v_)(e.share_code),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("i",{class:(0,t.C4)([p(e.file_type),"file-type-icon"])},null,2),(0,s.eW)(" "+(0,t.v_)(e.file_name),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("span",sl,(0,t.v_)(e.user_id||"-"),1)]),(0,s.Lk)("td",null,(0,t.v_)(f(e.created_time)),1),(0,s.Lk)("td",tl,[(0,s.Lk)("span",il,(0,t.v_)(e.view_count),1)]),(0,s.Lk)("td",nl,[(0,s.Lk)("span",ol,(0,t.v_)(e.download_count),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",cl,(0,t.v_)(e.access_password||"未设置"),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"action-btn",onClick:a=>L(e)},"删除",8,ul)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Ya,a[5]||(a[5]=[(0,s.Lk)("div",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-share-alt"})],-1),(0,s.Lk)("div",{class:"title"},"暂无分享",-1),(0,s.Lk)("div",{class:"description"}," 系统中暂无用户创建的分享 ",-1)]))),d.value.total_pages>1?((0,s.uX)(),(0,s.CE)("div",rl,[(0,s.Lk)("span",dl," 第 "+(0,t.v_)(d.value.page)+" 页，共 "+(0,t.v_)(d.value.total_pages)+" 页 ("+(0,t.v_)(d.value.total)+" 项) ",1),(0,s.Lk)("div",vl,[(0,s.Lk)("button",{disabled:!d.value.has_prev,onClick:a[0]||(a[0]=e=>h(d.value.page-1))},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-chevron-left"},null,-1),(0,s.eW)(" 上一页 ")]),8,pl),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k(),e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:e,class:(0,t.C4)({active:e===d.value.page}),onClick:a=>h(e)},(0,t.v_)(e),11,fl)),[[u.aG,"..."!==e]])),128)),k().includes("...")?((0,s.uX)(),(0,s.CE)("span",kl,"...")):(0,s.Q3)("",!0),(0,s.Lk)("button",{disabled:!d.value.has_next,onClick:a[1]||(a[1]=e=>h(d.value.page+1))},a[8]||(a[8]=[(0,s.eW)(" 下一页 "),(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,hl)])])):(0,s.Q3)("",!0)])]))}};const Ll=(0,qe.A)(ml,[["__scopeId","data-v-7b1555e0"]]);var bl=Ll;const gl={class:"home-view"},yl={class:"home"},_l={key:0,class:"admin-switch"},Cl={class:"switch-tabs"};var wl={__name:"Share-View",setup(e){const a=(0,i.KR)("user"),l=(0,i.KR)(null),u=(0,s.EW)(()=>l.value&&!0===l.value.is_admin);return(0,s.sV)(async()=>{try{const e=await(0,r.Bf)();if(e){const e=(0,r.HW)();l.value=e}}catch(e){}}),(e,l)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",gl,[(0,s.bF)(o.A),(0,s.bF)(n.A)]),(0,s.Lk)("div",yl,[u.value?((0,s.uX)(),(0,s.CE)("div",_l,[(0,s.Lk)("div",Cl,[(0,s.Lk)("button",{class:(0,t.C4)(["tab-btn",{active:"user"===a.value}]),onClick:l[0]||(l[0]=e=>a.value="user")},l[2]||(l[2]=[(0,s.Lk)("i",{class:"fas fa-user"},null,-1),(0,s.eW)(" 分享管理 ")]),2),(0,s.Lk)("button",{class:(0,t.C4)(["tab-btn",{active:"admin"===a.value}]),onClick:l[1]||(l[1]=e=>a.value="admin")},l[3]||(l[3]=[(0,s.Lk)("i",{class:"fas fa-cog"},null,-1),(0,s.eW)(" 管理员模式 ")]),2)])])):(0,s.Q3)("",!0),"user"===a.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.bF)(Ka),(0,s.bF)(ea)],64)):(0,s.Q3)("",!0),"admin"===a.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.bF)(za),(0,s.bF)(bl)],64)):(0,s.Q3)("",!0)]),(0,s.bF)(c.A)],64))}};const El=(0,qe.A)(wl,[["__scopeId","data-v-5b79353b"]]);var xl=El}}]);
//# sourceMappingURL=241.ba6e00a8.js.map