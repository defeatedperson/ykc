"use strict";(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[735],{735:function(e,a,s){s.r(a),s.d(a,{default:function(){return ne}});s(4114),s(4603),s(7566),s(8721);var t=s(6436),n=s(7959),o=s(5167),i=s(3229),l=s(4127),r=s(648),c=s(1810);const u={class:"slider-verification"},d={key:0,class:"loading-state"},v={key:1,class:"success-state"},f={class:"slider-background"},m={key:0,class:"fas fa-arrow-right"},p={key:1,class:"fas fa-check"},g={key:3,class:"error-message"},w={key:4,class:"retry-button"};var k={__name:"Login-Slider",emits:["verified","failed"],setup(e,{expose:a,emit:s}){const i=s,l=(0,o.KR)(),r=(0,o.KR)(),c=(0,o.KR)(!1),k=(0,o.KR)(!1),h=(0,o.KR)(!1),y=(0,o.KR)(""),b=(0,o.KR)(0),_=(0,o.KR)(0),L=(0,o.KR)(""),C=(0,o.KR)(0),E=(0,o.KR)(20),R=(0,o.KR)(null);async function K(){try{c.value=!0,y.value="",k.value=!1,b.value=0,_.value=0;const e=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=get_slider"}),a=await e.json();if("ok"!==a.status)throw new Error("获取验证挑战失败");{L.value=a.robots_jwt;const e=l.value?.getBoundingClientRect().width||300,s=.2*e,t=.8*e;C.value=Math.floor(Math.random()*(t-s))+s,E.value=20}}catch(e){y.value=e.message||"初始化验证失败"}finally{c.value=!1}}function j(e){if(k.value||c.value)return;h.value=!0,y.value="";const a=l.value.getBoundingClientRect(),s=50,t=a.width-s,n=a=>{if(!h.value)return;const n=a.type.includes("touch")?a.touches[0].clientX:a.clientX,o=n-e;let i=Math.max(0,Math.min(o,t));b.value=i,_.value=i+s/2},o=async()=>{if(h.value){h.value=!1;try{const e=50,a=b.value+e/2,s=Math.floor(10*Math.random())-5,t=Math.round(a)+s,n=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=verify_slider&robots_jwt=${encodeURIComponent(L.value)}&user_position=${encodeURIComponent(t)}&target_position=${encodeURIComponent(C.value)}`}),o=await n.json();if("slider_ok"!==o.status)throw new Error("验证失败，请重试");k.value=!0,i("verified",o.account_jwt)}catch(e){y.value=e.message||"验证失败，请重试",b.value=0,_.value=0}}};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o,{once:!0}),document.addEventListener("touchmove",n),document.addEventListener("touchend",o,{once:!0})}function T(e){k.value||c.value||(e.preventDefault(),j(e.clientX))}function X(e){if(k.value||c.value)return;e.preventDefault();const a=e.touches[0];j(a.clientX)}return a({initChallenge:K,reset:()=>{k.value=!1,b.value=0,_.value=0,y.value="",L.value="",C.value=0,E.value=20,R.value=null}}),(0,t.sV)(()=>{K()}),(e,a)=>((0,t.uX)(),(0,t.CE)("div",u,[c.value?((0,t.uX)(),(0,t.CE)("div",d,a[0]||(a[0]=[(0,t.Lk)("div",{class:"loading-spinner"},null,-1),(0,t.Lk)("span",null,"正在加载验证...",-1)]))):k.value?((0,t.uX)(),(0,t.CE)("div",v,a[1]||(a[1]=[(0,t.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,t.Lk)("span",null,"验证成功",-1)]))):((0,t.uX)(),(0,t.CE)("div",{key:2,class:"slider-track",ref_key:"trackRef",ref:l},[(0,t.Lk)("div",f,[(0,t.Lk)("div",{class:"slider-fill",style:(0,n.Tr)({width:_.value+"px"})},null,4),(0,t.Lk)("div",{class:(0,n.C4)(["slider-text",{success:k.value,hidden:h.value||k.value}])},(0,n.v_)(k.value?"验证成功":"请拖动滑块到指定位置"),3),C.value>0&&!k.value?((0,t.uX)(),(0,t.CE)("div",{key:0,class:"target-indicator",style:(0,n.Tr)({left:C.value+"px"})},a[2]||(a[2]=[(0,t.Lk)("div",{class:"target-icon"},"⭕",-1)]),4)):(0,t.Q3)("",!0)]),(0,t.Lk)("div",{class:(0,n.C4)(["slider-button",{dragging:h.value,success:k.value}]),ref_key:"buttonRef",ref:r,style:(0,n.Tr)({left:b.value+"px"}),onMousedown:T,onTouchstart:X},[k.value?((0,t.uX)(),(0,t.CE)("i",p)):((0,t.uX)(),(0,t.CE)("i",m))],38)],512)),y.value?((0,t.uX)(),(0,t.CE)("div",g,(0,n.v_)(y.value),1)):(0,t.Q3)("",!0),y.value&&!c.value?((0,t.uX)(),(0,t.CE)("div",w,[(0,t.Lk)("button",{onClick:K},"重新验证")])):(0,t.Q3)("",!0)]))}},h=s(5932);const y=(0,h.A)(k,[["__scopeId","data-v-6a42d123"]]);var b=y,_=(s(8111),s(2489),s(7588),s(1701),s(3579),s(7510));const L={class:"init-form-wrapper"},C={key:0,class:"rewrite-warning"},E={key:0,class:"validation-tips"};var R={__name:"Login-Init",emits:["init-success"],setup(e,{emit:a}){const s=a,i=(0,o.KR)(!1),r=(0,o.KR)(!1),c=async()=>{try{const e=window.location.protocol,a=window.location.host,s=`${e}//${a}/api/auth/data/test.json`,t=await fetch(s,{method:"GET",cache:"no-cache"});200===t.status?r.value=!0:r.value=!1}catch(e){r.value=!1}},u=(0,o.Kh)({username:"",password:"",confirmPassword:""}),d=(0,o.Kh)({username:"",password:"",confirmPassword:""}),v=(0,t.EW)(()=>Object.values(u).some(e=>""!==e)),f=(0,t.EW)(()=>Object.entries(u).filter(([,e])=>""!==e).map(([e,a])=>({field:e,message:a}))),m=(0,t.EW)(()=>{const e=d.username.trim()&&d.password&&d.confirmPassword,a=!v.value,s=d.password===d.confirmPassword;return e&&a&&s}),p=e=>{const a=d[e];let s;switch(e){case"username":s=(0,_.TU)(a);break;case"password":s=(0,_.Oj)(a);break;case"confirmPassword":s=a?a!==d.password?{valid:!1,message:"两次输入的密码不一致"}:{valid:!0,message:""}:{valid:!1,message:"请确认密码"};break;default:s={valid:!0,message:""}}return u[e]=s.valid?"":s.message,"password"===e&&d.confirmPassword&&p("confirmPassword"),s.valid},g=e=>{u[e]&&(u[e]="")},w=()=>{let e=!0;Object.keys(u).forEach(e=>{u[e]=""});const a=(0,_.TU)(d.username);a.valid||(u.username=a.message,e=!1);const s=(0,_.Oj)(d.password);return s.valid||(u.password=s.message,e=!1),d.confirmPassword?d.password!==d.confirmPassword&&(u.confirmPassword="两次输入的密码不一致",e=!1):(u.confirmPassword="请确认密码",e=!1),e},k=(0,o.KR)(),h={username:[{validator:(e,a,s)=>{const t=(0,_.TU)(a);t.valid?s():s(new Error(t.message))},trigger:"blur"}],password:[{validator:(e,a,s)=>{const t=(0,_.Oj)(a);t.valid?s():s(new Error(t.message))},trigger:"blur"}],confirmPassword:[{validator:(e,a,s)=>{a?a!==d.password?s(new Error("两次输入的密码不一致")):s():s(new Error("请确认密码"))},trigger:"blur"}]},y=async()=>{if(!w())return void l.nk.error("请检查输入内容");const e=await k.value.validate().catch(()=>!1);if(e){i.value=!0;try{const e=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`username=${encodeURIComponent(d.username.trim())}&password=${encodeURIComponent(d.password)}`}),a=await e.json();"ok"===a.status||a.success?(l.nk.success("系统初始化成功！"),Object.assign(d,{username:"",password:"",confirmPassword:"",email:""}),Object.keys(u).forEach(e=>{u[e]=""}),s("init-success")):l.nk.error(a.message||"初始化失败，可能是密码强度不够")}catch(a){l.nk.error("初始化请求失败，请检查网络连接")}finally{i.value=!1}}};return(0,t.sV)(()=>{c()}),(e,a)=>{const s=(0,t.g2)("el-input"),o=(0,t.g2)("el-form-item"),l=(0,t.g2)("el-button"),c=(0,t.g2)("el-form");return(0,t.uX)(),(0,t.CE)("div",L,[r.value?((0,t.uX)(),(0,t.CE)("div",C,a[9]||(a[9]=[(0,t.Fv)('<div class="warning-header" data-v-36db5492><i class="fas fa-exclamation-triangle" data-v-36db5492></i><span data-v-36db5492>检测到安全风险</span></div><p data-v-36db5492>系统检测到敏感目录可被直接访问，建议立即配置伪静态规则以保护数据安全：</p><div class="rewrite-rules" data-v-36db5492><div class="rule-section" data-v-36db5492><h4 data-v-36db5492><i class="fab fa-nginx" data-v-36db5492></i> Nginx 配置</h4><pre data-v-36db5492><code data-v-36db5492>location / {\n    try_files $uri $uri/ /index.html;\n}\nlocation ~ ^/api/(auth|file|share)/data/ {\n    deny all;\n    return 403;\n}</code></pre></div><div class="rule-section" data-v-36db5492><h4 data-v-36db5492><i class="fab fa-apache" data-v-36db5492></i> Apache 配置 (.htaccess)</h4><pre data-v-36db5492><code data-v-36db5492>RewriteEngine On\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteRule ^(.*)$ /index.html [L]\nRewriteRule ^api/(auth|file|share)/data/ - [F,L]</code></pre></div></div><p class="warning-footer" data-v-36db5492>配置完成后刷新页面重新检测</p>',4)]))):(0,t.Q3)("",!0),a[12]||(a[12]=(0,t.Lk)("p",{class:"init-tip"},"系统尚未初始化，请创建管理员账户",-1)),(0,t.bF)(c,{ref_key:"initFormRef",ref:k,model:d,rules:h,class:"common-form"},{default:(0,t.k6)(()=>[(0,t.bF)(o,{prop:"username",error:u.username},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:d.username,"onUpdate:modelValue":a[0]||(a[0]=e=>d.username=e),placeholder:"管理员用户名（最多50字符）","prefix-icon":"User",size:"large",onBlur:a[1]||(a[1]=e=>p("username")),onInput:a[2]||(a[2]=e=>g("username")),maxlength:50},null,8,["modelValue"])]),_:1},8,["error"]),(0,t.bF)(o,{prop:"password",error:u.password},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:d.password,"onUpdate:modelValue":a[3]||(a[3]=e=>d.password=e),type:"password",placeholder:"管理员密码（8-32位）","prefix-icon":"Lock",size:"large","show-password":"",onBlur:a[4]||(a[4]=e=>p("password")),onInput:a[5]||(a[5]=e=>g("password")),maxlength:32},null,8,["modelValue"])]),_:1},8,["error"]),(0,t.bF)(o,{prop:"confirmPassword",error:u.confirmPassword},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:d.confirmPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>d.confirmPassword=e),type:"password",placeholder:"确认密码","prefix-icon":"Lock",size:"large","show-password":"",onBlur:a[7]||(a[7]=e=>p("confirmPassword")),onInput:a[8]||(a[8]=e=>g("confirmPassword")),maxlength:32},null,8,["modelValue"])]),_:1},8,["error"]),v.value?((0,t.uX)(),(0,t.CE)("div",E,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(f.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.field,class:"error-tip"},[a[10]||(a[10]=(0,t.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,t.Lk)("span",null,(0,n.v_)(e.message),1)]))),128))])):(0,t.Q3)("",!0),(0,t.bF)(l,{type:"primary",size:"large",loading:i.value,disabled:!m.value,onClick:y,class:"primary-btn"},{default:(0,t.k6)(()=>a[11]||(a[11]=[(0,t.Lk)("i",{class:"fas fa-rocket"},null,-1),(0,t.eW)(" 初始化系统 ")])),_:1,__:[11]},8,["loading","disabled"])]),_:1},8,["model"])])}}};const K=(0,h.A)(R,[["__scopeId","data-v-36db5492"]]);var j=K,T=s(1469);const X={class:"form-wrapper"},F={key:0,class:"validation-tips"};var x={__name:"Login-Form",props:{accountToken:{type:String,required:!0}},emits:["login-success","need-mfa"],setup(e,{emit:a}){const s=e,i=a,c=(0,o.KR)(!1),u=(0,o.Kh)({username:"",password:""}),d=(0,o.Kh)({username:"",password:""}),v=(0,o.KR)(),f=(0,t.EW)(()=>Object.values(u).some(e=>""!==e)),m=(0,t.EW)(()=>Object.entries(u).filter(([,e])=>""!==e).map(([e,a])=>({field:e,message:a}))),p=(0,t.EW)(()=>{const e=d.username.trim()&&d.password,a=!f.value,t=s.accountToken&&s.accountToken.trim().length>0;return e&&a&&t}),g=e=>{const a=d[e];let s;switch(e){case"username":s=(0,_.TU)(a);break;case"password":s=(0,_.Oj)(a);break;default:s={valid:!0,message:""}}return u[e]=s.valid?"":s.message,s.valid},w=e=>{u[e]&&(u[e]="")},k=()=>{Object.keys(u).forEach(e=>{u[e]=""});let e=!0;const a=(0,_.TU)(d.username);a.valid||(u.username=a.message,e=!1);const s=(0,_.Oj)(d.password);return s.valid||(u.password=s.message,e=!1),e},h={username:[{validator:(e,a,s)=>{const t=(0,_.TU)(a);t.valid?s():s(new Error(t.message))},trigger:"blur"}],password:[{validator:(e,a,s)=>{const t=(0,_.Oj)(a);t.valid?s():s(new Error(t.message))},trigger:"blur"}]},y=async()=>{if(!k())return void l.nk.error("请检查输入内容");if(!s.accountToken||!s.accountToken.trim())return void l.nk.error("请先完成人机验证");const e=await v.value.validate().catch(()=>!1);if(e){c.value=!0;try{const e=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=verify_account&username=${encodeURIComponent(d.username.trim())}&password=${encodeURIComponent(d.password)}&account_jwt=${encodeURIComponent(s.accountToken)}`}),a=await e.json();"need_mfa"===a.status?i("need-mfa",{mfa_jwt:a.mfa_jwt,username:d.username.trim()}):"ok"===a.status?((0,r.fE)(a),i("login-success")):l.nk.error("登录失败，请检查用户名和密码")}catch(a){l.nk.error(a.message||"登录失败")}finally{c.value=!1}}};return(e,a)=>{const s=(0,t.g2)("el-input"),o=(0,t.g2)("el-form-item"),i=(0,t.g2)("el-button"),l=(0,t.g2)("el-form");return(0,t.uX)(),(0,t.CE)("div",X,[a[8]||(a[8]=(0,t.Lk)("div",{class:"form-title"},[(0,t.Lk)("i",{class:"fas fa-sign-in-alt"}),(0,t.Lk)("span",null,"用户登录")],-1)),(0,t.bF)(l,{ref_key:"loginFormRef",ref:v,model:d,rules:h,class:"common-form"},{default:(0,t.k6)(()=>[(0,t.bF)(o,{prop:"username",error:u.username},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:d.username,"onUpdate:modelValue":a[0]||(a[0]=e=>d.username=e),placeholder:"用户名","prefix-icon":"User",size:"large",onBlur:a[1]||(a[1]=e=>g("username")),onInput:a[2]||(a[2]=e=>w("username")),maxlength:50},null,8,["modelValue"])]),_:1},8,["error"]),(0,t.bF)(o,{prop:"password",error:u.password},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:d.password,"onUpdate:modelValue":a[3]||(a[3]=e=>d.password=e),type:"password",placeholder:"密码","prefix-icon":"Lock",size:"large","show-password":"",onKeyup:(0,T.jR)(y,["enter"]),onBlur:a[4]||(a[4]=e=>g("password")),onInput:a[5]||(a[5]=e=>w("password")),maxlength:32},null,8,["modelValue"])]),_:1},8,["error"]),f.value?((0,t.uX)(),(0,t.CE)("div",F,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(m.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.field,class:"error-tip"},[a[6]||(a[6]=(0,t.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,t.Lk)("span",null,(0,n.v_)(e.message),1)]))),128))])):(0,t.Q3)("",!0),(0,t.bF)(i,{type:"primary",size:"large",loading:c.value,disabled:!p.value,onClick:y,class:"primary-btn"},{default:(0,t.k6)(()=>a[7]||(a[7]=[(0,t.Lk)("i",{class:"fas fa-sign-in-alt"},null,-1),(0,t.eW)(" 登录 ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model"]),a[9]||(a[9]=(0,t.Lk)("div",{class:"warning-tip-simple"},[(0,t.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,t.Lk)("span",null,"多次验证失败会被暂时封禁IP地址")],-1))])}}};const I=(0,h.A)(x,[["__scopeId","data-v-af78b660"]]);var $=I;const U={class:"mfa-form-wrapper"},P={class:"mfa-form"},O={class:"verification-input-container"},V={key:0,class:"error-message"},S=["disabled"],M={key:0,class:"fas fa-spinner fa-spin"},A={key:1,class:"fas fa-check"};var Q={__name:"Login-Mfa",props:{mfaJwt:{type:String,required:!0}},emits:["login-success","back-to-login"],setup(e,{emit:a}){const s=e,i=a,c=(0,o.KR)(!1),u=(0,o.KR)(""),d=(0,o.KR)(""),v=()=>{d.value="",u.value=u.value.replace(/\D/g,"")},f=async()=>{if(6===u.value.length){c.value=!0,d.value="";try{const e=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=verify_mfa&mfa_jwt=${encodeURIComponent(s.mfaJwt)}&mfa_token=${encodeURIComponent(u.value)}`}),a=await e.json();"ok"===a.status?((0,r.fE)(a),l.nk.success("验证成功"),i("login-success")):(d.value="验证码错误",u.value="")}catch(d){l.nk.error(d.message||"验证失败"),d.message&&d.message.includes("令牌")?setTimeout(()=>{i("back-to-login")},2e3):(d.value=d.message||"验证失败",u.value="")}finally{c.value=!1}}else d.value="请输入6位验证码"},m=()=>{i("back-to-login")};return(e,a)=>((0,t.uX)(),(0,t.CE)("div",U,[a[3]||(a[3]=(0,t.Lk)("div",{class:"form-title"},[(0,t.Lk)("i",{class:"fas fa-shield-alt"}),(0,t.Lk)("span",null,"双重认证")],-1)),a[4]||(a[4]=(0,t.Lk)("div",{class:"mfa-info"},[(0,t.Lk)("p",null,"请输入身份验证器应用生成的6位验证码")],-1)),(0,t.Lk)("div",P,[(0,t.Lk)("div",O,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),type:"text",class:"verification-input",placeholder:"000000",maxlength:"6",onInput:v,onKeyup:(0,T.jR)(f,["enter"]),autofocus:""},null,544),[[T.Jo,u.value]]),d.value?((0,t.uX)(),(0,t.CE)("div",V,[a[1]||(a[1]=(0,t.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,t.Lk)("span",null,(0,n.v_)(d.value),1)])):(0,t.Q3)("",!0)]),(0,t.Lk)("button",{class:"verify-btn",disabled:6!==u.value.length||c.value,onClick:f},[c.value?((0,t.uX)(),(0,t.CE)("i",M)):((0,t.uX)(),(0,t.CE)("i",A)),(0,t.eW)(" "+(0,n.v_)(c.value?"验证中...":"验证"),1)],8,S)]),a[5]||(a[5]=(0,t.Fv)('<div class="mfa-tips" data-v-05c9c719><div class="tip-item" data-v-05c9c719><i class="fas fa-info-circle" data-v-05c9c719></i><span data-v-05c9c719>验证码每30秒更新一次</span></div><div class="tip-item" data-v-05c9c719><i class="fas fa-mobile-alt" data-v-05c9c719></i><span data-v-05c9c719>请使用您设置的身份验证器应用</span></div></div>',1)),(0,t.Lk)("div",{class:"back-action"},[(0,t.Lk)("button",{class:"back-btn",onClick:m},a[2]||(a[2]=[(0,t.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,t.eW)(" 返回登录 ")]))])]))}};const W=(0,h.A)(Q,[["__scopeId","data-v-05c9c719"]]);var z=W,B=s(4605);const N={class:"login-view"},D={class:"login-container"},Y={class:"login-header"},q={key:0,class:"login-form-container"},G={key:1,class:"login-form-container"},J={class:"slider-container"},Z={key:2,class:"login-form-container"},H={key:3,class:"login-form-container"},ee={class:"status-indicator"},ae={class:"status-item"};var se={__name:"Login-View",setup(e){const a=`${window.location.protocol}//${window.location.host}/api/pact.php`,s=(0,i.rd)(),u=(0,o.KR)("YKC云阶快传"),d=async()=>{try{const e=window.location.protocol,a=window.location.host,s=`${e}//${a}/api/data/site.json`,t=await fetch(s);if(t.ok){const e=await t.json();e.siteName&&(u.value=e.siteName)}}catch(e){}},v=(0,o.KR)("init"),f=(0,o.KR)(""),m=(0,o.KR)(""),p=(0,o.KR)(),g=(0,o.KR)(),w=(0,o.KR)(),k=async()=>{try{const e=new URLSearchParams;e.append("action","check_init");const a=await fetch("/api/auth/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}),t=await a.json();"initialized"===t.status?v.value="verification":"not_initialized"===t.status?v.value="init":"already_logged_in"===t.status?(l.nk.success("检测到已登录状态，正在跳转..."),s.push("/file")):"ip_banned"===t.status?l.nk.error(`IP已被封禁，解封时间: ${new Date(1e3*t.until).toLocaleString()}`):v.value="init"}catch(e){l.nk.error("系统检查失败，请刷新页面重试"),v.value="init"}},h=e=>{e?(f.value=e,v.value="login",l.nk.success("人机验证成功，请登录")):l.nk.error("验证成功但令牌无效，请重试")},y=()=>{f.value="",l.nk.error("人机验证失败，请重试"),p.value&&p.value.reset()},_=()=>{l.nk.success("登录成功，正在跳转..."),setTimeout(()=>{s.push("/file")},1e3)},L=e=>{m.value=e.mfa_jwt,v.value="mfa",l.nk.info("需要双重认证验证")},C=()=>{v.value="verification",f.value="",m.value="",p.value&&p.value.reset()},E=()=>{k()};return(0,t.sV)(async()=>{const e=await(0,r.Bf)();if(e)return l.nk.success("检测到登录状态，正在跳转..."),void s.push("/file");k(),d()}),(e,s)=>((0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",N,[(0,t.bF)(c.A),(0,t.Lk)("div",D,[(0,t.Lk)("div",Y,[(0,t.Lk)("h1",null,(0,n.v_)(u.value),1),s[0]||(s[0]=(0,t.Lk)("p",{class:"subtitle"},"安全、快速的文件传输平台",-1))]),"init"===v.value?((0,t.uX)(),(0,t.CE)("div",q,[s[1]||(s[1]=(0,t.Lk)("div",{class:"form-title"},[(0,t.Lk)("i",{class:"fas fa-tools"}),(0,t.Lk)("span",null,"系统初始化")],-1)),(0,t.bF)(j,{onInitSuccess:E})])):"verification"===v.value?((0,t.uX)(),(0,t.CE)("div",G,[s[2]||(s[2]=(0,t.Lk)("div",{class:"form-title"},[(0,t.Lk)("i",{class:"fas fa-shield-alt"}),(0,t.Lk)("span",null,"安全验证")],-1)),(0,t.Lk)("div",J,[(0,t.bF)(b,{ref_key:"sliderRef",ref:p,onVerified:h,onFailed:y},null,512)]),s[3]||(s[3]=(0,t.Lk)("div",{class:"verification-description"},[(0,t.Lk)("p",null,"为了保护系统安全，请完成人机验证")],-1))])):"login"===v.value?((0,t.uX)(),(0,t.CE)("div",Z,[(0,t.bF)($,{"account-token":f.value,onLoginSuccess:_,onNeedMfa:L,ref_key:"loginFormRef",ref:g},null,8,["account-token"])])):"mfa"===v.value?((0,t.uX)(),(0,t.CE)("div",H,[(0,t.bF)(z,{"mfa-jwt":m.value,onLoginSuccess:_,onBackToLogin:C,ref_key:"mfaFormRef",ref:w},null,8,["mfa-jwt"])])):(0,t.Q3)("",!0),(0,t.Lk)("div",ee,[(0,t.Lk)("div",ae,[s[4]||(s[4]=(0,t.Lk)("i",{class:"fas fa-circle"},null,-1)),(0,t.Lk)("span",null,(0,n.v_)("init"===v.value?"等待初始化":"安全登录中"),1)])]),(0,t.Lk)("div",{class:"agreement-tip"},[(0,t.Lk)("p",null,[s[5]||(s[5]=(0,t.eW)("登录/初始化即代表同意 ")),(0,t.Lk)("a",{href:a,target:"_blank",class:"agreement-link"},"《软件使用协议》")])])])]),(0,t.bF)(B.A)],64))}};const te=(0,h.A)(se,[["__scopeId","data-v-2afea143"]]);var ne=te},1810:function(e,a,s){s.d(a,{A:function(){return d}});s(4114);var t=s(6436),n=s(7959),o=s(5167);const i={class:"halo-background"},l=100;var r={__name:"Back-Ground",setup(e){const a=(0,o.KR)([]),s=()=>{const e=1.2*Math.random()+.4,a=100*Math.random(),s=100*Math.random(),t=.5*Math.random()+.3,n=2*Math.random()+1;return{id:Date.now()+Math.random(),style:{width:`${e}px`,height:`${e}px`,left:`${a}vw`,top:`${s}vh`,opacity:t,filter:`blur(${n}px)`}}};return(0,t.sV)(()=>{for(let e=0;e<l;e++)a.value.push(s())}),(e,s)=>((0,t.uX)(),(0,t.CE)("div",i,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,style:(0,n.Tr)(e.style),class:"halo-star"},null,4))),128)),s[0]||(s[0]=(0,t.Lk)("div",{class:"halo-glow halo-glow1"},null,-1)),s[1]||(s[1]=(0,t.Lk)("div",{class:"halo-glow halo-glow2"},null,-1)),s[2]||(s[2]=(0,t.Lk)("div",{class:"halo-glow halo-glow3"},null,-1))]))}},c=s(5932);const u=(0,c.A)(r,[["__scopeId","data-v-a14dfe84"]]);var d=u},4605:function(e,a,s){s.d(a,{A:function(){return k}});var t=s(6436),n=s(7959);const o={class:"foot-menu"},i={class:"footer-content"},l={class:"left-info"},r={class:"copyright"},c={class:"right-info"},u={class:"record-info"},d={key:0,href:"https://beian.miit.gov.cn",target:"_blank"},v={key:1},f={key:2,href:"https://beian.mps.gov.cn/#/query/webSearch",target:"_blank",class:"security-record"};function m(e,a,s,m,p,g){return(0,t.uX)(),(0,t.CE)("footer",o,[(0,t.Lk)("div",i,[(0,t.Lk)("div",l,[(0,t.Lk)("p",r,"© "+(0,n.v_)(p.currentYear)+" "+(0,n.v_)(p.siteConfig.siteName||"云阶快传")+" | 版权所有",1),a[0]||(a[0]=(0,t.Lk)("div",{class:"powered-by"},"由 YKC 驱动 | StarUI V3",-1))]),(0,t.Lk)("div",c,[(0,t.Lk)("div",u,[p.siteConfig.icp?((0,t.uX)(),(0,t.CE)("a",d,(0,n.v_)(p.siteConfig.icp),1)):(0,t.Q3)("",!0),p.siteConfig.icp&&p.siteConfig.securityRecord?((0,t.uX)(),(0,t.CE)("span",v," ")):(0,t.Q3)("",!0),p.siteConfig.securityRecord?((0,t.uX)(),(0,t.CE)("a",f,[a[1]||(a[1]=(0,t.Lk)("img",{src:"/img/beian.png",alt:"网安备案",class:"beian-icon"},null,-1)),(0,t.eW)(" "+(0,n.v_)(p.siteConfig.securityRecord),1)])):(0,t.Q3)("",!0)])])])])}var p={name:"FootMenu",data(){return{siteConfig:{siteName:"云阶快传",icp:"",securityRecord:""},currentYear:(new Date).getFullYear()}},async mounted(){await this.loadSiteConfig()},methods:{async loadSiteConfig(){if(window._siteConfigCache)this.siteConfig=window._siteConfigCache;else try{const e=window.location.protocol,a=window.location.host,s=`${e}//${a}/api/data/site.json`,t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){const e=await t.json(),a={siteName:e.siteName||"云阶快传",icp:e.icp||"",securityRecord:e.securityRecord||""};this.siteConfig=a,window._siteConfigCache=a}}catch(e){}}}},g=s(5932);const w=(0,g.A)(p,[["render",m],["__scopeId","data-v-ebe30562"]]);var k=w},5932:function(e,a){a.A=(e,a)=>{const s=e.__vccOpts||e;for(const[t,n]of a)s[t]=n;return s}},7510:function(e,a,s){s.d(a,{DT:function(){return o},Oj:function(){return n},TU:function(){return t}});const t=e=>{if(!e)return{valid:!1,message:"用户名不能为空"};if(e.length<3)return{valid:!1,message:"用户名至少需要3个字符"};if(e.length>20)return{valid:!1,message:"用户名不能超过20个字符"};const a=/^[a-zA-Z0-9_-]+$/;return a.test(e)?{valid:!0,message:""}:{valid:!1,message:"用户名只能包含字母、数字、下划线和中划线"}},n=e=>{if(!e)return{valid:!1,message:"密码不能为空",strength:"weak"};if(e.length<8)return{valid:!1,message:"密码至少需要8个字符",strength:"weak"};if(e.length>128)return{valid:!1,message:"密码不能超过128个字符",strength:"weak"};let a="weak",s=0;return/[a-z]/.test(e)&&s++,/[A-Z]/.test(e)&&s++,/\d/.test(e)&&s++,/[!@#$%^&*(),.?":{}|<>]/.test(e)&&s++,e.length>=12&&s++,s>=4?a="strong":s>=3&&(a="medium"),s<3?{valid:!1,message:"密码强度不足，请包含大小写字母、数字和特殊字符",strength:a}:{valid:!0,message:"",strength:a}},o=e=>{if(!e)return{valid:!1,message:"邮箱不能为空"};const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.test(e)?e.length>254?{valid:!1,message:"邮箱地址过长"}:{valid:!0,message:""}:{valid:!1,message:"请输入有效的邮箱地址"}}}}]);
//# sourceMappingURL=735.8eb30b13.js.map