(function(){"use strict";var t={648:function(t,e,n){n.d(e,{AT:function(){return d},Bf:function(){return l},Em:function(){return f},H2:function(){return h},HW:function(){return c},Mu:function(){return u},fE:function(){return p},fM:function(){return a},ri:function(){return v}});n(4979);const o="/api/auth";let r=null;const i=t=>{r=t},a=()=>r,u=()=>{r=null},s=t=>{if(!t)return!1;try{const e=t.split(".");if(3!==e.length)return!1;const n=JSON.parse(atob(e[1]));return 1e3*n.exp>Date.now()}catch{return!1}},c=()=>{if(!r||!s(r))return null;try{const t=r.split("."),e=JSON.parse(atob(t[1]));return{user_id:e.uid,username:e.sub,is_admin:e.adm||!1}}catch(t){return null}},l=async()=>{if(!r||!s(r))try{const t=await fetch(`${o}/daily-jwt-api.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),e=await t.json();return"account_jwt_missing"===e.status||"account_jwt_invalid"===e.status?(i(null),"login"===e.redirect&&window.dispatchEvent(new CustomEvent("auth:login-required",{detail:{reason:e.status,message:e.message}})),!1):"ok"===e.status&&e.visit_jwt?(i(e.visit_jwt),!0):(i(null),!1)}catch(t){return i(null),!1}return!0},f=async(t,e={})=>{const n={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...e.headers},o=await fetch(t,{...e,headers:n,credentials:"include"});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.json()},d=async(t,e={})=>{const n=await l();if(!n)throw new Error("认证失败，请重新登录");const o={...r&&{Authorization:`Bearer ${r}`},...e.headers},i=await fetch(t,{...e,headers:o,credentials:"include"});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=await i.json();if("visit_jwt_invalid"===a.status||"jwt_expired"===a.status||"jwt_invalid"===a.status||"refresh_token"===a.action){const n=await l();if(n){const n={...r&&{Authorization:`Bearer ${r}`},...e.headers},o=await fetch(t,{...e,headers:n,credentials:"include"});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.json()}throw new Error("认证失败，请重新登录")}return a},p=t=>{t.visit_jwt&&(r=t.visit_jwt)},v=async()=>{try{return u(),await fetch(`${o}/logout.php`,{method:"POST",credentials:"include"}),!0}catch{return!1}},h=async(t,e={},n={})=>{try{const o=await l();if(!o)throw new Error("认证失败，请重新登录");let r;if(e instanceof FormData){r=e,r.append("action",t);const n=a();n&&r.append("jwt",n)}else{r=new FormData,r.append("action",t);const n=a();n&&r.append("jwt",n);for(const[t,o]of Object.entries(e))null!==o&&void 0!==o&&""!==o&&r.append(t,o)}const i={method:"POST",body:r,credentials:"include",...n},u="/api/file/file-api.php",s=await fetch(u,i);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const c=await s.json();return c}catch(o){throw o}}},4081:function(t,e,n){var o=n(1469),r=n(6436),i=n(7959),a=n(5167);const u={id:"app"},s={key:0,class:"notification-overlay"},c={class:"notification-header"},l={class:"notification-icon"},f={class:"notification-title"},d={class:"notification-body"},p={key:0,class:"notification-footer"},v={class:"confirm-header"},h={class:"confirm-title"},m={class:"confirm-body"},w={class:"confirm-footer"};var y={__name:"App",setup(t){const e=(0,a.KR)(!1),n=(0,a.KR)({title:"",message:"",type:"info",showClose:!0,showButton:!0,closeButtonText:"确定",duration:0});let y=null;const b=t=>{const e={success:"fas fa-check-circle",error:"fas fa-times-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return e[t]||e.info},g=t=>{const e={success:"成功",error:"错误",warning:"警告",info:"提示"};return e[t]||e.info},k=(0,a.KR)(!1),C=(0,a.KR)({title:"",message:"",width:"30%",showClose:!0,cancelButtonText:"取消",confirmButtonText:"确认",callback:null,resolve:null,onCancel:null,onConfirm:null}),T=t=>new Promise(e=>{C.value={...C.value,...t,resolve:e},k.value=!0}),_=()=>{k.value=!1,"function"===typeof C.value.onCancel&&C.value.onCancel(),"function"===typeof C.value.resolve&&C.value.resolve(!1)},E=()=>{k.value=!1,"function"===typeof C.value.onConfirm&&C.value.onConfirm(),"function"===typeof C.value.resolve&&C.value.resolve(!0)},j=t=>{y&&(clearTimeout(y),y=null),n.value={title:"",message:"",type:"info",showClose:!0,showButton:!0,closeButtonText:"确定",duration:0,...t},e.value=!0,n.value.duration>0&&(y=setTimeout(()=>{L()},n.value.duration))},L=()=>{e.value=!1,y&&(clearTimeout(y),y=null),"function"===typeof n.value.onClose&&n.value.onClose()},x=()=>{!1!==C.value.closeOnClickModal&&_()};return(0,r.Gt)("notification",{open:j,close:L}),(0,r.Gt)("confirm",{open:T,cancel:_,submit:E}),(t,a)=>{const y=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(y),e.value?((0,r.uX)(),(0,r.CE)("div",s,[(0,r.Lk)("div",{class:(0,i.C4)(["notification-box",`notification-${n.value.type||"info"}`])},[(0,r.Lk)("div",c,[(0,r.Lk)("div",l,[(0,r.Lk)("i",{class:(0,i.C4)(b(n.value.type))},null,2)]),(0,r.Lk)("h4",f,(0,i.v_)(n.value.title||g(n.value.type)),1),!1!==n.value.showClose?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"notification-close",onClick:L},a[1]||(a[1]=[(0,r.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,r.Q3)("",!0)]),(0,r.Lk)("div",d,[(0,r.Lk)("p",null,(0,i.v_)(n.value.message),1)]),!1!==n.value.showButton?((0,r.uX)(),(0,r.CE)("div",p,[(0,r.Lk)("button",{class:"notification-btn",onClick:L},(0,i.v_)(n.value.closeButtonText||"确定"),1)])):(0,r.Q3)("",!0)],2)])):(0,r.Q3)("",!0),k.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"confirm-overlay",onClick:x},[(0,r.Lk)("div",{class:"confirm-dialog",onClick:a[0]||(a[0]=(0,o.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",v,[(0,r.Lk)("h3",h,(0,i.v_)(C.value.title),1),!1!==C.value.showClose?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"confirm-close",onClick:_},a[2]||(a[2]=[(0,r.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,r.Q3)("",!0)]),(0,r.Lk)("div",m,[(0,r.Lk)("p",null,(0,i.v_)(C.value.message),1)]),(0,r.Lk)("div",w,[(0,r.Lk)("button",{class:"confirm-btn confirm-btn-cancel",onClick:_},(0,i.v_)(C.value.cancelButtonText||"取消"),1),(0,r.Lk)("button",{class:"confirm-btn confirm-btn-primary",onClick:E},(0,i.v_)(C.value.confirmButtonText||"确认"),1)])])])):(0,r.Q3)("",!0)])}}};const b=y;var g=b,k=n(3229),C=n(648);const T=[{path:"/",redirect:()=>"/login"},{path:"/file",component:()=>Promise.all([n.e(371),n.e(701),n.e(10)]).then(n.bind(n,2439))},{path:"/share",component:()=>Promise.all([n.e(701),n.e(241)]).then(n.bind(n,4007))},{path:"/login",component:()=>n.e(735).then(n.bind(n,735))},{path:"/settings",component:()=>Promise.all([n.e(371),n.e(701),n.e(28)]).then(n.bind(n,6209))},{path:"/download",component:()=>Promise.all([n.e(371),n.e(684)]).then(n.bind(n,7684))},{path:"/download/:shareCode",component:()=>Promise.all([n.e(371),n.e(684)]).then(n.bind(n,7684))},{path:"/:pathMatch(.*)*",redirect:"/login"}],_=(0,k.aE)({history:(0,k.LA)(),routes:T});_.beforeEach(async(t,e,n)=>{if("/"===t.path){const t=await(0,C.Bf)();return void n(t?"/file":"/login")}if("/login"===t.path||t.path.startsWith("/download"))return void n();const o=await(0,C.Bf)();o?n():n("/login")}),window.addEventListener("auth:login-required",()=>{_.replace("/login")});var E=_,j=n(8734);n(4188);const L=(0,o.Ef)(g);L.use(E),L.use(j.A);const x=window.location.pathname,O="/login"===x||x.startsWith("/download");O||(0,C.Bf)(),L.mount("#app")}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,o,r,i){if(!o){var a=1/0;for(l=0;l<t.length;l++){o=t[l][0],r=t[l][1],i=t[l][2];for(var u=!0,s=0;s<o.length;s++)(!1&i||a>=i)&&Object.keys(n.O).every(function(t){return n.O[t](o[s])})?o.splice(s--,1):(u=!1,i<a&&(a=i));if(u){t.splice(l--,1);var c=r();void 0!==c&&(e=c)}}return e}i=i||0;for(var l=t.length;l>0&&t[l-1][2]>i;l--)t[l]=t[l-1];t[l]=[o,r,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce(function(e,o){return n.f[o](t,e),e},[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{10:"349b0339",28:"83830fe0",241:"ba6e00a8",684:"4f501146",701:"96def744",735:"8eb30b13"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{10:"b4608035",28:"69f18304",241:"a8c55fd2",371:"2323b068",684:"8247b12d",735:"c74afe10"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="my-vue-app:";n.l=function(o,r,i,a){if(t[o])t[o].push(r);else{var u,s;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var f=c[l];if(f.getAttribute("src")==o||f.getAttribute("data-webpack")==e+i){u=f;break}}u||(s=!0,u=document.createElement("script"),u.charset="utf-8",u.timeout=120,n.nc&&u.setAttribute("nonce",n.nc),u.setAttribute("data-webpack",e+i),u.src=o),t[o]=[r];var d=function(e,n){u.onerror=u.onload=null,clearTimeout(p);var r=t[o];if(delete t[o],u.parentNode&&u.parentNode.removeChild(u),r&&r.forEach(function(t){return t(n)}),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=d.bind(null,u.onerror),u.onload=d.bind(null,u.onload),s&&document.head.appendChild(u)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){if("undefined"!==typeof document){var t=function(t,e,o,r,i){var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",n.nc&&(a.nonce=n.nc);var u=function(n){if(a.onerror=a.onload=null,"load"===n.type)r();else{var o=n&&n.type,u=n&&n.target&&n.target.href||e,s=new Error("Loading CSS chunk "+t+" failed.\n("+o+": "+u+")");s.name="ChunkLoadError",s.code="CSS_CHUNK_LOAD_FAILED",s.type=o,s.request=u,a.parentNode&&a.parentNode.removeChild(a),i(s)}};return a.onerror=a.onload=u,a.href=e,o?o.parentNode.insertBefore(a,o.nextSibling):document.head.appendChild(a),a},e=function(t,e){for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var r=n[o],i=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(i===t||i===e))return r}var a=document.getElementsByTagName("style");for(o=0;o<a.length;o++){r=a[o],i=r.getAttribute("data-href");if(i===t||i===e)return r}},o=function(o){return new Promise(function(r,i){var a=n.miniCssF(o),u=n.p+a;if(e(a,u))return r();t(o,u,null,r,i)})},r={524:0};n.f.miniCss=function(t,e){var n={10:1,28:1,241:1,371:1,684:1,735:1};r[t]?e.push(r[t]):0!==r[t]&&n[t]&&e.push(r[t]=o(t).then(function(){r[t]=0},function(e){throw delete r[t],e}))}}}(),function(){var t={524:0,453:0};n.f.j=function(e,o){var r=n.o(t,e)?t[e]:void 0;if(0!==r)if(r)o.push(r[2]);else if(/^(371|453)$/.test(e))t[e]=0;else{var i=new Promise(function(n,o){r=t[e]=[n,o]});o.push(r[2]=i);var a=n.p+n.u(e),u=new Error,s=function(o){if(n.o(t,e)&&(r=t[e],0!==r&&(t[e]=void 0),r)){var i=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;u.message="Loading chunk "+e+" failed.\n("+i+": "+a+")",u.name="ChunkLoadError",u.type=i,u.request=a,r[1](u)}};n.l(a,s,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,o){var r,i,a=o[0],u=o[1],s=o[2],c=0;if(a.some(function(e){return 0!==t[e]})){for(r in u)n.o(u,r)&&(n.m[r]=u[r]);if(s)var l=s(n)}for(e&&e(o);c<a.length;c++)i=a[c],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(l)},o=self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[710,26,453,504],function(){return n(4081)});o=n.O(o)})();
//# sourceMappingURL=app.50760223.js.map